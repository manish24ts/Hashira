<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Polynomial Visualizer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    header {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, #3a8ef6, #6f3af6);
      color: white;
      text-align: center;
      font-size: 1.8em;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .container {
      background: white;
      padding: 30px;
      margin-top: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      width: 80%;
      max-width: 900px;
      text-align: center;
    }
    .input-section {
      margin-bottom: 30px;
      text-align: left;
    }
    .input-method {
      margin-bottom: 25px;
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      transition: border-color 0.3s;
    }
    .input-method:hover {
      border-color: #3a8ef6;
    }
    .input-method.active {
      border-color: #3a8ef6;
      background: #f8fbff;
    }
    .method-title {
      font-size: 1.2em;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    .method-title input[type="radio"] {
      margin-right: 10px;
      transform: scale(1.2);
    }
    input[type="file"], input[type="url"], textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1em;
      box-sizing: border-box;
    }
    input[type="url"] {
      margin-bottom: 10px;
    }
    textarea {
      resize: vertical;
      min-height: 120px;
      font-family: 'Courier New', monospace;
    }
    button {
      padding: 12px 24px;
      margin: 10px 5px;
      background: linear-gradient(135deg, #3a8ef6, #6f3af6);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      transition: 0.3s;
      font-weight: bold;
    }
    button:hover {
      background: linear-gradient(135deg, #2a6ed6, #5a2ad6);
      transform: translateY(-2px);
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    #constantDisplay {
      margin: 30px 0;
      padding: 20px;
      font-size: 1.5em;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(135deg, #32cd32, #228b22);
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(50, 205, 50, 0.3);
      border: 3px solid #228b22;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    #constantDisplay.hidden {
      display: none;
    }
    canvas {
      margin-top: 20px;
      max-height: 500px;
    }
    .loading {
      display: none;
      color: #3a8ef6;
      font-weight: bold;
      margin: 10px 0;
    }
    .error {
      color: #f63a3a;
      background: #ffe6e6;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      display: none;
    }
    .success {
      color: #228b22;
      background: #e6ffe6;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      display: none;
    }
  </style>
</head>
<body>
  <header>Polynomial Visualizer</header>
  <div class="container">
    <div class="input-section">
      <!-- File Upload Method -->
      <div class="input-method" id="fileMethod">
        <div class="method-title">
          <input type="radio" name="inputMethod" value="file" id="fileRadio" checked>
          <label for="fileRadio">üìÅ Upload JSON File</label>
        </div>
        <input type="file" id="fileInput" accept=".json" disabled>
      </div>

      <!-- API Endpoint Method -->
      <div class="input-method" id="apiMethod">
        <div class="method-title">
          <input type="radio" name="inputMethod" value="api" id="apiRadio">
          <label for="apiRadio">üåê API Endpoint</label>
        </div>
        <input type="url" id="apiInput" placeholder="Enter API endpoint URL (e.g., https://api.example.com/polynomial)" disabled>
        <small style="color: #666;">The API should return JSON data in the expected format</small>
      </div>

      <!-- Direct JSON Input Method -->
      <div class="input-method" id="jsonMethod">
        <div class="method-title">
          <input type="radio" name="inputMethod" value="json" id="jsonRadio">
          <label for="jsonRadio">üìù Paste JSON Content</label>
        </div>
        <textarea id="jsonInput" placeholder='Paste your JSON content here, e.g.:
{
  "keys": {"n": 4, "k": 3},
  "1": {"base": "10", "value": "4"},
  "2": {"base": "2", "value": "111"},
  "3": {"base": "10", "value": "12"}
}' disabled></textarea>
      </div>
    </div>

    <div style="text-align: center;">
      <button onclick="processData()" id="processBtn">üöÄ Process & Visualize</button>
      <div class="loading" id="loading">Processing data...</div>
      <div class="error" id="error"></div>
      <div class="success" id="success"></div>
    </div>

    <div id="constantDisplay" class="hidden"></div>
    <canvas id="polyChart"></canvas>
  </div>

  <script>
    let chartInstance = null; 

    // Initialize input method selection
    document.addEventListener('DOMContentLoaded', function() {
      setupInputMethods();
      updateActiveMethod();
    });

    function setupInputMethods() {
      const radios = document.querySelectorAll('input[name="inputMethod"]');
      radios.forEach(radio => {
        radio.addEventListener('change', updateActiveMethod);
      });
    }

    function updateActiveMethod() {
      const selectedMethod = document.querySelector('input[name="inputMethod"]:checked').value;
      
      // Remove active class from all methods
      document.querySelectorAll('.input-method').forEach(method => {
        method.classList.remove('active');
      });
      
      // Disable all inputs
      document.getElementById('fileInput').disabled = true;
      document.getElementById('apiInput').disabled = true;
      document.getElementById('jsonInput').disabled = true;
      
      // Enable selected method
      switch(selectedMethod) {
        case 'file':
          document.getElementById('fileMethod').classList.add('active');
          document.getElementById('fileInput').disabled = false;
          break;
        case 'api':
          document.getElementById('apiMethod').classList.add('active');
          document.getElementById('apiInput').disabled = false;
          break;
        case 'json':
          document.getElementById('jsonMethod').classList.add('active');
          document.getElementById('jsonInput').disabled = false;
          break;
      }
    }

    function showMessage(type, message) {
      hideMessages();
      const element = document.getElementById(type);
      element.textContent = message;
      element.style.display = 'block';
    }

    function hideMessages() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'none';
      document.getElementById('success').style.display = 'none';
    }

    function convertValue(base, valueStr) {
      return parseInt(valueStr, parseInt(base));
    }

    function lagrange(points, x) {
      let result = 0;
      const k = points.length;
      for (let i = 0; i < k; i++) {
        let term = points[i].y;
        for (let j = 0; j < k; j++) {
          if (j !== i) {
            term *= (x - points[j].x) / (points[i].x - points[j].x);
          }
        }
        result += term;
      }
      return result;
    }

    async function processData() {
      const selectedMethod = document.querySelector('input[name="inputMethod"]:checked').value;
      showMessage('loading', 'Processing data...');

      try {
        let data;
        
        switch(selectedMethod) {
          case 'file':
            data = await processFileInput();
            break;
          case 'api':
            data = await processApiInput();
            break;
          case 'json':
            data = processJsonInput();
            break;
        }

        if (data) {
          plotPolynomial(data);
          showMessage('success', 'Data processed successfully!');
        }
      } catch (error) {
        showMessage('error', `Error: ${error.message}`);
      }
    }

    function processFileInput() {
      return new Promise((resolve, reject) => {
        const fileInput = document.getElementById("fileInput");
        const file = fileInput.files[0];
        
        if (!file) {
          reject(new Error("Please select a JSON file first."));
          return;
        }

        const reader = new FileReader();
        reader.onload = function(event) {
          try {
            const data = JSON.parse(event.target.result);
            resolve(data);
          } catch (e) {
            reject(new Error("Invalid JSON file format."));
          }
        };
        reader.onerror = () => reject(new Error("Error reading file."));
        reader.readAsText(file);
      });
    }

    async function processApiInput() {
      const apiUrl = document.getElementById('apiInput').value.trim();
      
      if (!apiUrl) {
        throw new Error("Please enter an API endpoint URL.");
      }

      try {
        const response = await fetch(apiUrl);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        return data;
      } catch (error) {
        throw new Error(`Failed to fetch data from API: ${error.message}`);
      }
    }

    function processJsonInput() {
      const jsonContent = document.getElementById('jsonInput').value.trim();
      
      if (!jsonContent) {
        throw new Error("Please paste JSON content.");
      }

      try {
        return JSON.parse(jsonContent);
      } catch (error) {
        throw new Error("Invalid JSON format. Please check your input.");
      }
    }

    function plotPolynomial(data) {
      const n = data.keys.n;
      const k = data.keys.k;
      let points = [];

      let count = 0;
      for (let key of Object.keys(data)) {
        if (key === "keys") continue;
        if (count >= k) break;

        const base = data[key].base;
        const value = data[key].value;

        const x = parseInt(key);
        const y = convertValue(base, value);

        points.push({ x, y });
        count++;
      }

      const minX = Math.min(...points.map(p => p.x)) - 1;
      const maxX = Math.max(...points.map(p => p.x)) + 1;
      let curveX = [];
      let curveY = [];

      for (let x = minX; x <= maxX; x += 0.1) {
        curveX.push(x);
        curveY.push(lagrange(points, x));
      }

      const constant = lagrange(points, 0);
      const constantDisplay = document.getElementById("constantDisplay");
      constantDisplay.innerHTML = `
        <div style="font-size: 1.2em; margin-bottom: 10px;">üéØ POLYNOMIAL CONSTANT</div>
        <div style="font-size: 2em;">f(0) = ${constant}</div>
        <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.9;">The secret constant term of the polynomial</div>
      `;
      constantDisplay.classList.remove('hidden');

      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(document.getElementById("polyChart"), {
        type: "line",
        data: {
          labels: curveX,
          datasets: [
            {
              label: "Polynomial Curve",
              data: curveX.map((x, i) => ({ x, y: curveY[i] })),
              borderColor: "#3a8ef6",
              borderWidth: 3,
              fill: false,
              pointRadius: 0,
              tension: 0.3
            },
            {
              label: "Given Points",
              data: points,
              backgroundColor: "#ff6666",
              borderColor: "#ff3333",
              type: "scatter",
              pointRadius: 8,
              pointBorderWidth: 2
            },
            {
              label: "Constant f(0)",
              data: [{ x: 0, y: constant }],
              backgroundColor: "#32cd32",
              borderColor: "#228b22",
              type: "scatter",
              pointRadius: 12,
              pointBorderWidth: 3
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { 
              position: "bottom",
              labels: {
                usePointStyle: true,
                padding: 20,
                font: {
                  size: 14
                }
              }
            }
          },
          scales: {
            x: { 
              type: "linear", 
              title: { 
                display: true, 
                text: "x",
                font: { size: 16 }
              },
              grid: {
                color: '#e0e0e0'
              }
            },
            y: { 
              title: { 
                display: true, 
                text: "f(x)",
                font: { size: 16 }
              },
              grid: {
                color: '#e0e0e0'
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>