<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hashira Polynomial Visualizer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        header {
            width: 100%;
            padding: 15px 20px;
            background: linear-gradient(135deg, #e31e24, #b71c1c);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(227, 30, 36, 0.3);
        }
        .logo {
            height: 50px;
            margin-right: 20px;
        }
        .header-text {
            font-size: 1.8em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .container {
            background: white;
            padding: 30px;
            margin-top: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 900px;
            text-align: center;
            border-top: 4px solid #e31e24;
        }
        .input-section {
            margin-bottom: 30px;
            text-align: left;
        }
        .input-method {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .input-method:hover {
            border-color: #e31e24;
            box-shadow: 0 2px 8px rgba(227, 30, 36, 0.1);
        }
        .input-method.active {
            border-color: #e31e24;
            background: linear-gradient(135deg, #fff5f5, #ffebee);
            box-shadow: 0 4px 12px rgba(227, 30, 36, 0.15);
        }
        .method-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .method-title input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
            accent-color: #e31e24;
        }
        input[type="file"], input[type="url"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        input[type="file"]:focus, input[type="url"]:focus, textarea:focus {
            border-color: #e31e24;
            outline: none;
            box-shadow: 0 0 0 2px rgba(227, 30, 36, 0.1);
        }
        input[type="url"] {
            margin-bottom: 10px;
        }
        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: 'Courier New', monospace;
        }
        button {
            padding: 12px 24px;
            margin: 10px 5px;
            background: linear-gradient(135deg, #e31e24, #b71c1c);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(227, 30, 36, 0.3);
        }
        button:hover {
            background: linear-gradient(135deg, #d32f2f, #9a0007);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(227, 30, 36, 0.4);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #constantDisplay {
            margin: 30px 0;
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(135deg, #e31e24, #b71c1c);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(227, 30, 36, 0.4);
            border: 3px solid #b71c1c;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        #constantDisplay.hidden {
            display: none;
        }
        #warningMessage {
            color: #ff9800;
            background: #fff3e0;
            padding: 10px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            border-left: 4px solid #ff9800;
            font-size: 0.9em;
        }
        canvas {
            margin-top: 20px;
            max-height: 500px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .loading {
            display: none;
            color: #e31e24;
            font-weight: bold;
            margin: 10px 0;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
            border-left: 4px solid #e31e24;
        }
        .success {
            color: #2e7d32;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
            border-left: 4px solid #4caf50;
        }
        .hashira-accent {
            color: #e31e24;
            font-weight: bold;
        }
        .powered-by {
            margin-top: 30px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            color: #666;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .powered-by img {
            height: 25px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <header>
        <img src="logo.png" alt="Hashira Logo" class="logo">
        <div class="header-text">Polynomial Visualizer</div>
    </header>
    <div class="container">
        <div class="input-section">
            <div class="input-method" id="fileMethod">
                <div class="method-title">
                    <input type="radio" name="inputMethod" value="file" id="fileRadio" checked>
                    <label for="fileRadio">üìÅ Upload JSON File</label>
                </div>
                <input type="file" id="fileInput" accept=".json" disabled>
            </div>

            <div class="input-method" id="apiMethod">
                <div class="method-title">
                    <input type="radio" name="inputMethod" value="api" id="apiRadio">
                    <label for="apiRadio">üåê API Endpoint</label>
                </div>
                <input type="url" id="apiInput" placeholder="Enter API endpoint URL (e.g., https://api.example.com/polynomial)" disabled>
                <small style="color: #666;">The API should return JSON data in the expected format</small>
            </div>

            <div class="input-method" id="jsonMethod">
                <div class="method-title">
                    <input type="radio" name="inputMethod" value="json" id="jsonRadio">
                    <label for="jsonRadio">üìù Paste JSON Content</label>
                </div>
                <textarea id="jsonInput" placeholder='Paste your JSON content here, e.g.:
{
    "keys": {"n": 4, "k": 3},
    "1": {"base": "10", "value": "4"},
    "2": {"base": "2", "value": "111"},
    "3": {"base": "10", "value": "12"}
}' disabled></textarea>
            </div>
        </div>

        <div style="text-align: center;">
            <button onclick="processData()" id="processBtn">üöÄ Process & Visualize</button>
            <div class="loading" id="loading">Processing data...</div>
            <div class="error" id="error"></div>
            <div class="success" id="success"></div>
        </div>

        <div id="constantDisplay" class="hidden"></div>
        <div id="warningMessage" style="display: none;">
            ‚ö†Ô∏è The y-values are extremely large and have been converted to floating-point numbers for visualization. The constant term displayed is the precise value.
        </div>
        <canvas id="polyChart"></canvas>

        <div class="powered-by">
            <span>Powered by</span>
            <img src="logo.png" alt="Hashira">
        </div>
    </div>

    <script>
        let chartInstance = null;

        // Initialize input method selection
        document.addEventListener('DOMContentLoaded', function() {
            setupInputMethods();
            updateActiveMethod();
        });

        function setupInputMethods() {
            const radios = document.querySelectorAll('input[name="inputMethod"]');
            radios.forEach(radio => {
                radio.addEventListener('change', updateActiveMethod);
            });
        }

        function updateActiveMethod() {
            const selectedMethod = document.querySelector('input[name="inputMethod"]:checked').value;
            
            document.querySelectorAll('.input-method').forEach(method => {
                method.classList.remove('active');
            });
            
            document.getElementById('fileInput').disabled = true;
            document.getElementById('apiInput').disabled = true;
            document.getElementById('jsonInput').disabled = true;
            
            switch(selectedMethod) {
                case 'file':
                    document.getElementById('fileMethod').classList.add('active');
                    document.getElementById('fileInput').disabled = false;
                    break;
                case 'api':
                    document.getElementById('apiMethod').classList.add('active');
                    document.getElementById('apiInput').disabled = false;
                    break;
                case 'json':
                    document.getElementById('jsonMethod').classList.add('active');
                    document.getElementById('jsonInput').disabled = false;
                    break;
            }
        }

        function showMessage(type, message) {
            hideMessages();
            const element = document.getElementById(type);
            element.textContent = message;
            element.style.display = 'block';
        }

        function hideMessages() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('success').style.display = 'none';
        }

        // ---- NEW: Custom base-to-decimal converter for BigInts ----
        function convertValue(baseStr, valueStr) {
            const base = BigInt(baseStr);
            let decimalValue = 0n;
            
            for (let i = 0; i < valueStr.length; i++) {
                const char = valueStr[i];
                let digit;
                if (/[0-9]/.test(char)) {
                    digit = BigInt(parseInt(char, 10));
                } else {
                    digit = BigInt(char.toLowerCase().charCodeAt(0) - 'a'.charCodeAt(0) + 10);
                }
                decimalValue += digit * (base ** BigInt(valueStr.length - 1 - i));
            }
            return decimalValue;
        }

        // ---- NEW: Lagrange Interpolation with BigInts ----
        function lagrange(points, x) {
            const k = points.length;
            const xBig = BigInt(x);
            let result = 0n;

            for (let i = 0; i < k; i++) {
                const xi = BigInt(points[i].x);
                const yi = points[i].y;

                let liAtxNumerator = 1n;
                let liAtxDenominator = 1n;

                for (let j = 0; j < k; j++) {
                    if (j !== i) {
                        const xj = BigInt(points[j].x);
                        liAtxNumerator *= (xBig - xj);
                        liAtxDenominator *= (xi - xj);
                    }
                }
                
                result += (yi * liAtxNumerator) / liAtxDenominator;
            }
            return result;
        }

        async function processData() {
            const selectedMethod = document.querySelector('input[name="inputMethod"]:checked').value;
            showMessage('loading', 'Processing data...');

            try {
                let data;
                
                switch(selectedMethod) {
                    case 'file':
                        data = await processFileInput();
                        break;
                    case 'api':
                        data = await processApiInput();
                        break;
                    case 'json':
                        data = processJsonInput();
                        break;
                }

                if (data) {
                    plotPolynomial(data);
                    showMessage('success', 'Data processed successfully!');
                }
            } catch (error) {
                showMessage('error', `Error: ${error.message}`);
            }
        }

        function processFileInput() {
            return new Promise((resolve, reject) => {
                const fileInput = document.getElementById("fileInput");
                const file = fileInput.files[0];
                
                if (!file) {
                    reject(new Error("Please select a JSON file first."));
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        resolve(data);
                    } catch (e) {
                        reject(new Error("Invalid JSON file format."));
                    }
                };
                reader.onerror = () => reject(new Error("Error reading file."));
                reader.readAsText(file);
            });
        }

        async function processApiInput() {
            const apiUrl = document.getElementById('apiInput').value.trim();
            
            if (!apiUrl) {
                throw new Error("Please enter an API endpoint URL.");
            }

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                throw new Error(`Failed to fetch data from API: ${error.message}`);
            }
        }

        function processJsonInput() {
            const jsonContent = document.getElementById('jsonInput').value.trim();
            
            if (!jsonContent) {
                throw new Error("Please paste JSON content.");
            }

            try {
                return JSON.parse(jsonContent);
            } catch (error) {
                throw new Error("Invalid JSON format. Please check your input.");
            }
        }

        function plotPolynomial(data) {
            const k = data.keys.k;
            let points = [];
            const isLargeValuePresent = Object.values(data).some(d => d.value && d.value.length > 15);

            let count = 0;
            for (let key of Object.keys(data)) {
                if (key === "keys") continue;
                if (count >= k) break;

                const base = data[key].base;
                const value = data[key].value;

                const x = parseInt(key, 10);
                const y = convertValue(base, value);

                points.push({ x, y });
                count++;
            }

            // Calculate constant term with BigInt for precision
            const constant = lagrange(points, 0);
            
            // Display constant term
            const constantDisplay = document.getElementById("constantDisplay");
            constantDisplay.innerHTML = `
                <div style="font-size: 1.2em; margin-bottom: 10px;">üéØ POLYNOMIAL CONSTANT</div>
                <div style="font-size: 2em;">f(0) = ${constant.toString()}</div>
                <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.9;">The secret constant term of the polynomial</div>
            `;
            constantDisplay.classList.remove('hidden');

            // --- Plotting Logic ---
            const plotPoints = points.map(p => ({ x: p.x, y: Number(p.y) }));
            const plotConstant = Number(constant);

            // Show warning if large numbers were detected
            document.getElementById('warningMessage').style.display = isLargeValuePresent ? 'block' : 'none';

            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(document.getElementById("polyChart"), {
                type: "line",
                data: {
                    datasets: [
                        {
                            label: "Given Points",
                            data: plotPoints,
                            backgroundColor: "#ff5722",
                            borderColor: "#e31e24",
                            type: "scatter",
                            pointRadius: 8,
                            pointBorderWidth: 2
                        },
                        {
                            label: "Constant f(0)",
                            data: [{ x: 0, y: plotConstant }],
                            backgroundColor: "#4caf50",
                            borderColor: "#2e7d32",
                            type: "scatter",
                            pointRadius: 12,
                            pointBorderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: "bottom",
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: "linear",
                            title: {
                                display: true,
                                text: "x",
                                font: { size: 16 }
                            },
                            grid: {
                                color: '#f0f0f0'
                            }
                        },
                        y: {
                            type: "linear",
                            title: {
                                display: true,
                                text: "f(x)",
                                font: { size: 16 }
                            },
                            grid: {
                                color: '#f0f0f0'
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>

